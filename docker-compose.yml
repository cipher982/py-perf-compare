services:
  base:
    build:
      context: .
      dockerfile: docker/Dockerfile.base
    image: py-perf-compare-base

  cpython:
    build:
      context: .
      dockerfile: docker/Dockerfile.cpython
    volumes:
      - ./results:/results
    depends_on:
      - base

  pypy:
    build:
      context: .
      dockerfile: docker/Dockerfile.pypy
    volumes:
      - ./results:/results
    depends_on:
      - base

  benchmark-controller:
    build:
      context: .
      dockerfile: docker/Dockerfile.cpython
    volumes:
      - ./results:/results
    depends_on:
      - cpython
      - pypy
    command: ["all", "--runs", "3", "--cpu-limit", "1000000", "--memory-size", "200", "--mixed-size", "500"]
